<div
  class="max-w-5xl p-8 mx-auto bg-white border border-gray-100 rounded-lg shadow-lg"
>
  <a
    routerLink="/cards"
    class="mb-6 inline-flex items-center gap-1.5 text-sm font-medium text-blue-600 transition-colors hover:text-blue-800"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 20 20"
      fill="currentColor"
      class="w-5 h-5"
    >
      <path
        fill-rule="evenodd"
        d="M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z"
        clip-rule="evenodd"
      />
    </svg>
    Back to List
  </a>

  <h2 class="mb-6 text-3xl font-bold tracking-tight text-gray-900">
    Import Business Cards
  </h2>

  <div
    *ngIf="error"
    class="flex items-center gap-3 p-4 mb-4 text-sm font-medium text-red-800 bg-red-100 rounded-lg"
    role="alert"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 20 20"
      fill="currentColor"
      class="w-5 h-5"
    >
      <path
        fill-rule="evenodd"
        d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z"
        clip-rule="evenodd"
      />
    </svg>
    <span>{{ error }}</span>
  </div>

  <div *ngIf="!isLoading && !isPreviewing">
    <p class="mb-4 text-gray-600">
      Upload an XML or CSV file. You will get a chance to preview before
      importing.
    </p>
    <div
      appDragDrop
      (fileDropped)="onFileSelected($event)"
      (click)="fileInput.click()"
      class="flex flex-col items-center justify-center p-12 transition-colors border-2 border-gray-300 border-dashed rounded-lg cursor-pointer hover:border-blue-500 hover:bg-blue-50"
    >
      <svg
        class="w-12 h-12 text-gray-400"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M12 16.5V9.75m0 0l-3 3m3-3l3 3M6.75 19.5a4.5 4.5 0 01-1.41-8.775 5.25 5.25 0 0110.33 0 4.5 4.5 0 01-1.41 8.775H6.75z"
        />
      </svg>
      <p class="mt-2 font-semibold text-gray-700">Drag & Drop your file here</p>
      <p class="text-sm text-gray-500">
        or <span class="font-medium text-blue-600">click to browse</span>
      </p>
    </div>
    <input
      type="file"
      #fileInput
      (change)="onFileSelected($event)"
      class="hidden"
      accept=".csv, .xml, .png, .jpeg, .jpg"
    />
  </div>

  <div *ngIf="isLoading" class="py-16 text-center">
    <svg
      class="w-10 h-10 mx-auto text-blue-600 animate-spin"
      xmlns="http://www.w3.org/2000/svg"
      fill="none"
      viewBox="0 0 24 24"
    >
      <circle
        class="opacity-25"
        cx="12"
        cy="12"
        r="10"
        stroke="currentColor"
        stroke-width="4"
      ></circle>
      <path
        class="opacity-75"
        fill="currentColor"
        d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
      ></path>
    </svg>
    <p class="mt-4 text-lg font-medium text-gray-700">Parsing your file...</p>
  </div>

  <div *ngIf="isPreviewing">
    <h3 class="mb-4 text-xl font-semibold text-gray-700">
      Preview Import ({{ previewCards.length }} cards)
    </h3>
    <p class="mb-4 text-gray-600">
      Review and import the cards you want, one by one.
    </p>

    <div class="overflow-hidden border border-gray-200 rounded-lg">
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th
                scope="col"
                class="px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-500 uppercase"
              >
                Name
              </th>
              <th
                scope="col"
                class="px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-500 uppercase"
              >
                Email
              </th>
              <th
                scope="col"
                class="px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-500 uppercase"
              >
                Phone
              </th>
              <th
                scope="col"
                class="px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-500 uppercase"
              >
                Gender
              </th>
              <th
                scope="col"
                class="px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-500 uppercase"
              >
                Address
              </th>
              <th
                scope="col"
                class="px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-500 uppercase"
              >
                DOB
              </th>
              <th
                scope="col"
                class="px-6 py-3 text-xs font-medium tracking-wider text-right text-gray-500 uppercase"
              >
                Action
              </th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <tr
              *ngFor="let card of previewCards"
              class="transition-colors hover:bg-gray-50"
            >
              <td class="px-6 py-4 text-sm text-gray-800 whitespace-nowrap">
                {{ card.name }}
              </td>
              <td class="px-6 py-4 text-sm text-gray-600 whitespace-nowrap">
                {{ card.email }}
              </td>
              <td class="px-6 py-4 text-sm text-gray-600 whitespace-nowrap">
                {{ card.phone }}
              </td>
              <td class="px-6 py-4 text-sm text-gray-600 whitespace-nowrap">
                {{ card.gender }}
              </td>
              <td class="px-6 py-4 text-sm text-gray-600 whitespace-nowrap">
                {{ card.address }}
              </td>
              <td class="px-6 py-4 text-sm text-gray-600 whitespace-nowrap">
                {{ card.dateOfBirth | date : "shortDate" }}
              </td>
              <td
                class="px-6 py-4 text-sm font-medium text-right whitespace-nowrap"
              >
                <button
                  *ngIf="card.importState === 'pending'"
                  (click)="onImportRow(card)"
                  class="px-3 py-1 text-xs font-medium text-blue-700 transition-colors duration-150 bg-blue-100 rounded-md hover:bg-blue-200"
                >
                  Import
                </button>

                <button
                  *ngIf="card.importState === 'importing'"
                  disabled
                  class="inline-flex items-center px-3 py-1 text-xs font-medium text-gray-700 bg-gray-100 rounded-md cursor-wait"
                >
                  <svg
                    class="w-4 h-4 mr-1.5 animate-spin"
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                  >
                    <circle
                      class="opacity-25"
                      cx="12"
                      cy="12"
                      r="10"
                      stroke="currentColor"
                      stroke-width="4"
                    ></circle>
                    <path
                      class="opacity-75"
                      fill="currentColor"
                      d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                    ></path>
                  </svg>
                  Importing...
                </button>

                <button
                  *ngIf="card.importState === 'imported'"
                  disabled
                  class="inline-flex items-center px-3 py-1 text-xs font-medium text-green-700 bg-green-100 rounded-md"
                >
                  <svg
                    class="w-4 h-4 mr-1.5"
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="2"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M5 13l4 4L19 7"
                    />
                  </svg>
                  Imported
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="flex justify-end mt-6 space-x-4">
      <button
        (click)="onCancel()"
        class="px-6 py-2 font-medium text-gray-700 transition-colors duration-150 bg-gray-100 rounded-md shadow-sm hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2"
      >
        Cancel
      </button>
    </div>
  </div>
</div>
